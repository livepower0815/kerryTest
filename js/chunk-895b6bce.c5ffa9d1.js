(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-895b6bce"],{"04a9":function(t,e,s){"use strict";s.r(e);var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("main",[s("section",{staticClass:"search container"},[s("div",{staticClass:"row"},[s("div",{staticClass:"col-12"},[s("form",{staticClass:"form"},[s("div",{staticClass:"input-group input-lg"},[s("div",{staticClass:"input"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.keyword,expression:"keyword"}],staticClass:"form-control",attrs:{type:"text",name:"keyowrd",id:"keyowrd",placeholder:"輸入群組名稱查詢"},domProps:{value:t.keyword},on:{input:function(e){e.target.composing||(t.keyword=e.target.value)}}})]),s("button",{staticClass:"btn btn-primary btn-icon",attrs:{type:"submit"},on:{click:function(e){e.stopPropagation(),e.preventDefault(),t.doSearch()}}},[s("i",{staticClass:"icon-search i-24"})])])])])])]),s("div",{staticClass:"container pt-4",class:{"section-loading":t.custsOfAgntIsLoading}},[s("h4",{staticClass:"text-green"},[t._v("\n      群組列表\n      "),s("a",{staticClass:"btn btn-default btn-sm m-0 ml-3",on:{click:function(e){t.createGroup()}}},[t._v("\n        新增群組\n      ")])]),0!=t.grpsOfAgnt.length?s("div",{staticClass:"list group"},t._l(t.grpsOfAgnt,function(e,n){return s("div",{key:"group-item-"+n,staticClass:"item"},[s("div",{staticClass:"name"},[s("router-link",{attrs:{to:{path:"/group/"+n,query:{grp_id:e.grp_id,grp_name:e.grp_name}}}},[s("h4",{staticClass:"link text-underline m-0"},[t._v(t._s(e.grp_name))])])],1),s("div",{staticClass:"action"},[s("a",{staticClass:"btn btn-sm btn-default btn-icon my-0",attrs:{role:"button"},on:{click:function(s){t.selectGroup(e,n)}}},[s("i",{staticClass:"icon-edit"})])])])})):s("div",{staticClass:"text-center",attrs:{colspan:"6"}},[s("h3",{staticClass:"mb-3"},[t._v(t._s(this.remoteDataMessage))])])]),s("warning-modal",{attrs:{open:t.warningModalOpen,message:t.warningData[t.currentWarningType].message},on:{close:function(e){t.panelClose("warningModalOpen")},submit:t.warningSubmit}}),s("add-group-modal",{attrs:{open:t.addGroupModalOpen,"is-edit":t.addGroupEdit,currentGroup:t.selectedGroup,custsOfAgnt:t.custsOfAgnt,custsOfGrp:t.custsOfGrp,custsOfAgntIsLoading:t.custsOfAgntIsLoading,custsOfGrpIsLoading:t.custsOfGrpIsLoading},on:{close:function(e){t.panelClose("addGroupModalOpen")},delete:t.beforeDel,submit:t.addGroupMember}})],1)},a=[],i=(s("ac6a"),s("7f7f"),s("be94")),r=s("2f62"),o=s("872c"),c=s("91d3"),d=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"modal fade",class:{"is-open":t.open}},[s("div",{staticClass:"modal-dialog"},[s("div",{staticClass:"modal-content"},[s("div",{staticClass:"modal-body"},[s("form",{staticClass:"form p-5",attrs:{action:""}},[s("div",{staticClass:"container"},[s("div",{staticClass:"form-group row py-5"},[s("label",{staticClass:"col-2 text-right",attrs:{for:"group_name"}},[t._v("群組名稱")]),s("div",{staticClass:"col-10"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.name,expression:"name"}],staticClass:"form-control",attrs:{type:"text",id:"group_name"},domProps:{value:t.name},on:{input:function(e){e.target.composing||(t.name=e.target.value)}}})])]),s("div",{staticClass:"action text-right"},[s("a",{staticClass:"btn btn-default",on:{click:function(e){t.$emit("close")}}},[t._v("\n                取消\n              ")]),s("a",{staticClass:"btn btn-primary",attrs:{disabled:""===t.name},on:{click:function(e){t.$emit("submit",t.name)}}},[t._v("\n                下一步\n              ")])])])])])])])])},l=[],u={name:"NewGroup",props:{open:{type:Boolean,default:!1},message:{type:String,default:""}},data:function(){return{name:""}}},p=u,f=s("2877"),m=Object(f["a"])(p,d,l,!1,null,null,null);m.options.__file="NewGroup.vue";var h=m.exports,g=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"modal fade",class:{"is-open":t.open}},[s("div",{staticClass:"modal-dialog"},[s("div",{staticClass:"modal-content"},[s("div",{staticClass:"modal-header"},[s("h3",{staticClass:"text-green m-0 mt-1"},[t._v("編輯群組成員")]),t.isEdit?s("a",{staticClass:"btn btn-default float-right m-0",attrs:{role:"button"},on:{click:function(e){t.$emit("delete",t.group)}}},[t._v("\n          刪除此群組\n        ")]):t._e()]),s("div",{staticClass:"modal-body"},[!1===!t.group?s("div",{staticClass:"row mt-2 mb-4"},[s("div",{staticClass:"col-12"},[s("form",{staticClass:"form"},[s("div",{staticClass:"form-group"},[s("h3",{staticClass:"d-inline-block mt-0 mb-2"},[t._v("\n                  標題\n                ")]),s("input",{directives:[{name:"model",rawName:"v-model",value:t.group.grp_name,expression:"group.grp_name"}],staticClass:"form-control form-control-inline",attrs:{type:"text",placeholder:"新群組"},domProps:{value:t.group.grp_name},on:{input:function(e){e.target.composing||t.$set(t.group,"grp_name",e.target.value)}}})]),s("div",{staticClass:"input-group input-lg"},[s("div",{staticClass:"input"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.keyword,expression:"keyword"}],staticClass:"form-control",attrs:{type:"text",name:"keyword",id:"keyword",placeholder:"輸入姓名、身分證進行搜尋..."},domProps:{value:t.keyword},on:{input:function(e){e.target.composing||(t.keyword=e.target.value)}}})]),s("button",{staticClass:"btn btn-primary btn-icon",attrs:{type:"submit"},on:{click:function(e){e.stopPropagation(),e.preventDefault(),t.doSearch()}}},[s("i",{staticClass:"icon-search i-24"})])])])])]):t._e(),s("div",{staticClass:"row row-tables newTable",class:{"section-loading":t.isLoadingData}},[s("div",{staticClass:"col-table pr-0"},[s("h5",[t._v("可選擇的客戶名單")]),s("table",{staticClass:"table datatable insurance-green",attrs:{id:"customer-list"}},[s("thead",[s("tr",[s("th",{attrs:{width:Math.floor(344*.28)+"px"},on:{click:function(e){t.sortArray("unselected","name")}}},[t._v("姓名")]),s("th",{attrs:{width:Math.floor(103.2)+"px"},on:{click:function(e){t.sortArray("unselected","identity")}}},[t._v("身分證")]),s("th",{attrs:{width:Math.floor(86)+"px"},on:{click:function(e){t.sortArray("unselected","birthday")}}},[t._v("生日")]),s("th")])]),s("tbody",t._l(t.unselectedMemData,function(e,n){return s("tr",{key:"familiy-item-"+n},[s("td",{attrs:{width:Math.floor(344*.28)+"px"}},[t._v(t._s(e.name))]),s("td",{attrs:{width:Math.floor(103.2)+"px"}},[t._v(t._s(e.identity))]),s("td",{attrs:{width:Math.floor(86)+"px"}},[t._v(t._s(t._f("dateFormat")(e.birthday)))]),s("td",[s("a",{staticClass:"text-orange",on:{click:function(e){t.addGroup(n)}}},[s("i",{staticClass:"icon-add_new i-20"})])])])}))])]),t._m(0),s("div",{staticClass:"col-table "},[s("h5",[t._v("已加入的名單")]),s("table",{staticClass:"table datatable insurance-green",attrs:{id:"new-group-list"}},[s("thead",[s("tr",[s("th",{attrs:{width:Math.floor(344*.28)+"px"},on:{click:function(e){t.sortArray("selected","name")}}},[t._v("姓名")]),s("th",{attrs:{width:Math.floor(103.2)+"px"},on:{click:function(e){t.sortArray("selected","identity")}}},[t._v("身分證")]),s("th",{attrs:{width:Math.floor(86)+"px"},on:{click:function(e){t.sortArray("selected","birthday")}}},[t._v("生日")]),s("th")])]),s("tbody",t._l(t.selectedMemData,function(e,n){return s("tr",{key:"familiy-item-"+n},[s("td",{attrs:{width:Math.floor(344*.28)+"px"}},[t._v(t._s(e.name))]),s("td",{attrs:{width:Math.floor(103.2)+"px"}},[t._v(t._s(e.identity))]),s("td",{attrs:{width:Math.floor(86)+"px"}},[t._v(t._s(t._f("dateFormat")(e.birthday)))]),s("td",[s("a",{staticClass:"text-red",on:{click:function(e){t.removeGroup(n)}}},[s("i",{staticClass:"icon-trashcan i-20"})])])])}))])])]),s("div",{staticClass:"row"},[s("div",{staticClass:"col-12"},[s("div",{staticClass:"actions text-right mt-4"},[s("a",{staticClass:"btn btn-default",on:{click:function(e){t.$emit("close")}}},[t._v("取消")]),s("a",{staticClass:"btn btn-primary",on:{click:function(e){t.$emit("submit",t.group,t.selectedMemData)}}},[t._v("儲存")])])])])])])])])},v=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"px-2 text-light-green text-center col-split"},[s("i",{staticClass:"icon-forward"})])}],b=(s("55dd"),s("6762"),s("2fdb"),s("5df3"),s("4f7f"),{name:"AddGroupModal",props:{open:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!0},currentGroup:{type:Object,default:function(){return{grp_id:"",grp_name:""}}},custsOfAgnt:{type:Array,default:function(){return[]}},custsOfGrp:{type:Array,default:function(){return[]}},custsOfAgntIsLoading:{type:Boolean,default:!0},custsOfGrpIsLoading:{type:Boolean,default:!0}},watch:{open:"modalChange",custsOfAgntIsLoading:"refreshLoadingStatus",custsOfGrpIsLoading:"refreshLoadingStatus"},data:function(){return{group:{},keyword:"",selectedMemData:[{birthday:"",identity:"",name:""}],unselectedMemData:[{birthday:"",identity:"",name:""}],isLoadingData:!0,unselectedSort:!0,selectedSort:!0,unselectedItem:"name",selectedItem:"name"}},methods:{addGroup:function(t){this.selectedMemData.push(this.unselectedMemData.splice(t,1)[0]),this.sortArray()},removeGroup:function(t){this.unselectedMemData.push(this.selectedMemData.splice(t,1)[0]),this.sortArray()},filterOutById:function(t,e){var s=new Set(e.map(function(t){return t.identity})),n=t.filter(function(t){return!s.has(t.identity)});return n},doSearch:function(){var t=this;if(""!=this.keyword.trim()){var e=this.custsOfAgnt.filter(function(e){return e.name.includes(t.keyword)||e.identity.includes(t.keyword)});this.unselectedMemData=this.filterOutById(e,this.selectedMemData)}else this.unselectedMemData=this.filterOutById(this.custsOfAgnt,this.selectedMemData)},sortArray:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"name";"unselected"===t?this.unselectedSort&&this.unselectedItem===e?(this.unselectedSort=!this.unselectedSort,this.unselectedMemData=this.unselectedMemData.sort(function(t,s){return s[e]>=t[e]?1:-1})):(this.unselectedItem=e,this.unselectedSort=!0,this.unselectedMemData=this.unselectedMemData.sort(function(t,s){return t[e]>=s[e]?1:-1})):"selected"===t?this.selectedSort&&this.selectedItem===e?(this.selectedSort=!this.selectedSort,this.selectedMemData=this.selectedMemData.sort(function(t,s){return s[e]>=t[e]?1:-1})):(this.selectedItem=e,this.selectedSort=!0,this.selectedMemData=this.selectedMemData.sort(function(t,s){return t[e]>=s[e]?1:-1})):(this.unselectedMemData=this.unselectedMemData.sort(function(t,s){return t[e]>=s[e]?1:-1}),this.selectedMemData=this.selectedMemData.sort(function(t,s){return t[e]>=s[e]?1:-1}))},refreshData:function(){this.unselectedMemData=this.filterOutById(this.custsOfAgnt,this.custsOfGrp),this.selectedMemData=this.custsOfGrp,this.sortArray()},refreshLoadingStatus:function(){this.isLoadingData=this.custsOfAgntIsLoading||this.custsOfGrpIsLoading},modalChange:function(t){t&&(console.log(this.currentGroup),this.keyword="",this.group=Object(i["a"])({},this.currentGroup),this.refreshData())}},mounted:function(){}}),y=b,_=(s("5cf5"),Object(f["a"])(y,g,v,!1,null,"2e52e7ae",null));_.options.__file="AddGroupModal.vue";var C=_.exports,O=s("8e44"),w=(s("3022"),{name:"Group",mixins:[o["a"]],components:{WarningModal:c["a"],NewGroup:h,AddGroupModal:C},data:function(){return{keyword:"",currentWarningType:"confirmDel",newGroupOpen:!1,addGroupModalOpen:!1,addGroupEdit:!0,warningModalOpen:!1,oldGroup:null,warningData:{confirmDel:{message:"",submit:"confirmDel"}},selectedGroup:{name:""},selectedItem:0,groups:{name:"滿期年金",edit:!1},isEdit:!1,custsOfAgntIsLoading:!1,custsOfGrpIsLoading:!1,custsOfAgnt:[],grpsOfAgnt:[],custsOfGrp:[],remoteDataMessage:"資料讀取中，請稍候..."}},methods:Object(i["a"])({},Object(r["b"])(["setPageLock"]),{createGroup:function(){var t=this;this.custsOfAgntIsLoading=!0,this.addGroupEdit=!1,this.selectedGroup={grp_id:"",grp_name:""},this.custsOfGrp=[],Object(O["A"])(this.$store.state.userInfo.id).then(function(e){e.body.customer_list?t.custsOfAgnt=e.body.customer_list.map(function(t){return{name:t.name||"",gender:t.sex||"",identity:t.id,birthday:t.birthday||""}}):t.custsOfAgnt=[],t.custsOfAgntIsLoading=!1,t.panelOpen("addGroupModalOpen")})},selectGroup:function(t,e){var s=this;this.custsOfAgntIsLoading=!0,Object(O["A"])(this.$store.state.userInfo.id).then(function(n){n.body.customer_list?s.custsOfAgnt=n.body.customer_list.map(function(t){return{name:t.name||"",gender:t.sex||"",identity:t.id,birthday:t.birthday||""}}):s.custsOfAgnt=[],Object(O["D"])(s.$store.state.userInfo.id,t.grp_id).then(function(n){s.custsOfGrp=n?n.map(function(t){return{name:t.name,identity:t.id,birthday:t.birthday}}):[],s.custsOfAgntIsLoading=!1,s.addGroupEdit=!0,s.selectedItem=e,s.selectedGroup=t,s.panelOpen("addGroupModalOpen")})})},confirmDel:function(){var t=this,e=this.grpsOfAgnt[this.selectedItem];Object(O["rb"])(this.$store.state.userInfo.id,this.$store.state.userInfo.id,e.grp_id).then(function(s){"200"===s.header.status?(t.grpsOfAgnt.splice(t.selectedItem,1),t.$toast.info({title:"已刪除「".concat(e.grp_name,"」群組")})):t.$toast.info({title:"刪除「".concat(e.grp_name,"」群組失敗")})})},beforeDel:function(){this.panelClose("addGroupModalOpen"),this.currentWarningType="confirmDel",this.warningData.confirmDel.message="請確認是否刪除該群組及群組成員？",this.panelOpen("warningModalOpen")},warningSubmit:function(){var t=this.warningData[this.currentWarningType].submit;this[t](),this.panelClose("warningModalOpen")},toggleEdit:function(t){this.groups[t].edit=!0,this.isEdit=!0,this.currentEdit=t},addGroupMember:function(t,e){var s=this,n=[],a={};e.forEach(function(t){n.push(t.identity),a[t.identity]=t.name}),this.panelClose("addGroupModalOpen"),this.addGroupEdit?Object(O["yb"])(this.$store.state.userInfo.id,t.grp_id,t.grp_name,n).then(function(e){if(e.header.status&&"200"==e.header.status)s.groups[s.selectedItem]=t,s.initGroupVue(),s.$toast.info({title:"更新「".concat(t.grp_name,"」群組成功")});else if(e.body.errList){var n=e.body.errList||[],i="";n.forEach(function(t){i=i+"客戶: "+a[t]+" 已達群組上限，\n"}),i+="如需調整請至群組管理!!",s.$toast.info({title:i})}else s.$toast.info({title:e.header.message})}):Object(O["wb"])(this.$store.state.userInfo.id,null,t.grp_name,e).then(function(e){if(e.header.status&&"200"==e.header.status)s.initGroupVue(),s.$toast.info({title:"新增「".concat(t.grp_name,"」群組成功")});else if(e.body.errList){var n=e.body.errList||[],i="";n.forEach(function(t){i=i+"客戶: "+a[t]+" 已達群組上限，\n"}),i+="如需調整請至群組管理!!",s.$toast.info({title:i})}else s.$toast.info({title:e.header.message})})},doSearch:function(){var t=this;this.remoteDataMessage="資料讀取中，請稍候...",Object(O["F"])(this.$store.state.userInfo.id,this.$store.state.userInfo.id,this.keyword).then(function(e){e.body.groups?t.grpsOfAgnt=e.body.groups.map(function(t){return{grp_id:t.grp_id,grp_name:t.grp_name,edit:!1}}):t.grpsOfAgnt=[],t.remoteDataMessage="查無資料，請確認您輸入之資料是否正確"})},initGroupVue:function(){var t=this;this.remoteDataMessage="資料讀取中，請稍候...",this.custsOfAgntIsLoading=!0,Object(O["E"])(this.$store.state.userInfo.id,this.$store.state.userInfo.id).then(function(e){e.body.groups?t.grpsOfAgnt=e.body.groups.map(function(t){return{grp_id:t.grp_id,grp_name:t.grp_name,edit:!1}}):t.grpsOfAgnt=[],t.remoteDataMessage="查無資料，請確認您輸入之資料是否正確",t.custsOfAgntIsLoading=!1})}}),mounted:function(){this.initGroupVue()}}),M=w,G=Object(f["a"])(M,n,a,!1,null,null,null);G.options.__file="Group.vue";e["default"]=G.exports},"2f21":function(t,e,s){"use strict";var n=s("79e5");t.exports=function(t,e){return!!t&&n(function(){e?t.call(null,function(){},1):t.call(null)})}},"2fdb":function(t,e,s){"use strict";var n=s("5ca1"),a=s("d2c8"),i="includes";n(n.P+n.F*s("5147")(i),"String",{includes:function(t){return!!~a(this,t,i).indexOf(t,arguments.length>1?arguments[1]:void 0)}})},5147:function(t,e,s){var n=s("2b4c")("match");t.exports=function(t){var e=/./;try{"/./"[t](e)}catch(s){try{return e[n]=!1,!"/./"[t](e)}catch(a){}}return!0}},"55dd":function(t,e,s){"use strict";var n=s("5ca1"),a=s("d8e8"),i=s("4bf8"),r=s("79e5"),o=[].sort,c=[1,2,3];n(n.P+n.F*(r(function(){c.sort(void 0)})||!r(function(){c.sort(null)})||!s("2f21")(o)),"Array",{sort:function(t){return void 0===t?o.call(i(this)):o.call(i(this),a(t))}})},"5cf5":function(t,e,s){"use strict";var n=s("6889"),a=s.n(n);a.a},6762:function(t,e,s){"use strict";var n=s("5ca1"),a=s("c366")(!0);n(n.P,"Array",{includes:function(t){return a(this,t,arguments.length>1?arguments[1]:void 0)}}),s("9c6c")("includes")},6889:function(t,e,s){},"91d3":function(t,e,s){"use strict";var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"modal warning fade",class:{"is-open":t.open}},[s("div",{staticClass:"modal-dialog modal-sm"},[s("div",{staticClass:"modal-content"},[s("div",{staticClass:"modal-body"},[s("div",{staticClass:"warning"},[s("img",{attrs:{width:"48",src:t.BaseUrl+"assets/common/warning.png",srcset:t.BaseUrl+"assets/common/warning@2x.png"}}),s("span",{staticClass:"text",domProps:{innerHTML:t._s(t.message)}})]),s("div",{staticClass:"action text-right"},[t.showCancel?s("a",{staticClass:"btn btn-default",on:{click:function(e){t.$emit("close")}}},[t._v(t._s(t.cancelText))]):t._e(),s("a",{staticClass:"btn btn-primary",on:{click:function(e){t.$emit("submit")}}},[t._v(t._s(t.confirmText))])])])])])])},a=[],i=s("be94"),r=s("2f62"),o={name:"WarningModal",props:{open:{type:Boolean,default:!1},message:{type:String,default:""},cancelText:{type:String,default:"取消"},confirmText:{type:String,default:"確定"},showCancel:{type:Boolean,default:!0}},computed:Object(i["a"])({},Object(r["c"])(["BaseUrl"]))},c=o,d=s("2877"),l=Object(d["a"])(c,n,a,!1,null,null,null);l.options.__file="WarningModal.vue";e["a"]=l.exports},d2c8:function(t,e,s){var n=s("aae3"),a=s("be13");t.exports=function(t,e,s){if(n(e))throw TypeError("String#"+s+" doesn't accept regex!");return String(a(t))}}}]);
//# sourceMappingURL=chunk-895b6bce.c5ffa9d1.js.map