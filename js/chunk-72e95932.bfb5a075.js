(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-72e95932"],{"20d6":function(t,e,n){"use strict";var r=n("5ca1"),o=n("0a49")(6),a="findIndex",s=!0;a in[]&&Array(1)[a](function(){s=!1}),r(r.P+r.F*s,"Array",{findIndex:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}}),n("9c6c")(a)},"2b66":function(t,e,n){"use strict";n.r(e);var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("main",[n("customer-info",{attrs:{loading:!1}}),n("tab-header",{attrs:{current:t.currentTab}}),n("div",{staticClass:"tab-content"},[n("div",{staticClass:"container-fluid"},[n("div",{staticClass:"tab-pane active show"},[n("h4",{staticClass:"text-green mt-5 mb-3"},[t._v("\n          日誌紀錄\n          "),n("a",{staticClass:"btn btn-default btn-sm m-0",on:{click:function(e){t.panelOpen("newRecordModalOpen")}}},[t._v("新增紀錄")])]),n("div",{staticClass:"record-control row"},[n("div",{staticClass:"col-9"},[n("carousel",{ref:"carousel",attrs:{value:t.carouselPage,perPage:8,scrollPerPage:!1,paginationEnabled:!1,navigationEnabled:!0}},t._l(t.records,function(e,r){return n("slide",{key:"record-item-"+r},[n("button",{staticClass:"item",class:{active:t.currentYear==r},on:{click:function(n){t.currentYear=r,t.getQueryNote(e.year)}}},[t._v("\n                  "+t._s(e.year)+"\n                ")])])}))],1),n("div",{staticClass:"col-3"},[n("form",{staticClass:"form search-container"},[n("div",{staticClass:"form-group"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.recodrdKeyowrd,expression:"recodrdKeyowrd"}],staticClass:"form-control",attrs:{type:"text",placeholder:"輸入關鍵字"},domProps:{value:t.recodrdKeyowrd},on:{input:function(e){e.target.composing||(t.recodrdKeyowrd=e.target.value)}}}),t._m(0)])])])]),t.records[t.currentYear].data&&t.records[t.currentYear].data.length?n("div",{staticClass:"record-container"},t._l(t.records[t.currentYear].data,function(e,r){return n("div",{key:"event-record-"+r,staticClass:"record-item"},[n("div",{staticClass:"record-table"},[n("table",{staticClass:"table insurance-green"},[n("tr",[n("th",{attrs:{rowspan:"2",width:"100"}},[t._v(t._s(e.EVENT_DATE))]),n("th",{attrs:{width:"100"}},[t._v("私人筆記")]),n("td",[e.NOTE_STRING&&""!==e.NOTE_STRING?n("div",{domProps:{innerHTML:t._s(t.highlight(e.NOTE_STRING))}}):n("div",{staticClass:"content empty"},[t._v("您尚未填寫私人筆記")])])]),n("tr",[n("th",[t._v("活動日誌")]),n("td",[""===e.RECORD_STRING&&""===e.currentIndex?n("div",{staticClass:"content empty"},[t._v("\n                      您尚未填寫拜訪紀錄\n                    ")]):n("div",{staticClass:"content"},[n("h5",{domProps:{innerHTML:t._s(t.highlight(e.RECORD_STRING))}}),n("div",{staticClass:"list badgets"},t._l(t.getTagName(e.SUB_CLS_CODE),function(e,o){return n("div",{key:"record-"+r+"-tag-"+o,staticClass:"badget gray item",domProps:{innerHTML:t._s(t.highlight(e))}})}))])])])])]),n("div",{staticClass:"record-action text-right"},[n("a",{staticClass:"btn btn-default btn-icon btn-sm my-0",on:{click:function(n){t.editRecord(e,r)}}},[n("i",{staticClass:"icon-edit"})]),n("br"),n("a",{staticClass:"btn btn-red btn-icon btn-sm",on:{click:function(n){t.removeRecord(e,r)}}},[n("i",{staticClass:"icon-trashcan"})])])])})):n("div",{staticClass:"empty-block"},[t.isSearch?n("span",[t._v("找不到符合的資料，建議換其他關鍵字進行搜尋")]):n("span",[t._v("尚未有任何已完成的拜訪")])])])])]),n("new-record-modal",{attrs:{open:t.newRecordModalOpen,record:t.currentRecord},on:{close:function(e){t.panelClose("newRecordModalOpen")},submit:t.submitNewRecord}}),n("warning-modal",{attrs:{open:t.warningModalOpen,message:t.warningMessage},on:{close:function(e){t.panelClose("warningModalOpen")},submit:t.removeRecord}})],1)},o=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("button",{staticClass:"btn btn-icon btn-text m-0",attrs:{type:"submit"}},[n("i",{staticClass:"icon-search"})])}],a=(n("96cf"),n("1da1")),s=(n("c5f6"),n("28a5"),n("55dd"),n("7f7f"),n("3b2b"),n("a481"),n("20d6"),n("53ca")),i=(n("ac6a"),n("be94")),c=n("2f62"),d=n("0a63"),u=n("872c"),l=n("8e44"),f=n("df3a"),h=n("c45c"),m=n("35b6"),b=n("91d3"),p=n("5977"),g=(n("3022"),{name:"CustomerDetail",mixins:[u["a"]],data:function(){return{isSearch:!1,warningMessage:"",currentRecord:null,newRecordModalOpen:!1,records:[],currentYear:0,carouselRendered:!1,carouselPage:0,recodrdKeyowrd:"",currentTab:0,noteEdit:!1,warningModalOpen:!1,currentDelIndex:0,noteIsNewEdit:!0,note:null}},components:{Avatar:f["a"],CustomerInfo:h["a"],TabHeader:m["a"],Carousel:d["Carousel"],Slide:d["Slide"],WarningModal:b["a"],NewRecordModal:p["a"]},computed:Object(i["a"])({},Object(c["c"])(["BaseUrl"]),{searchResult:function(){var t=this;if(!this.recodrdKeyowrd.length)return[];var e=this.customer.record.reduce(function(e,n,r){return n.data.forEach(function(n){var r=!1;for(var o in n)"string"==typeof n[o]?n[o].indexOf(t.recodrdKeyowrd)>-1&&(r=!0):"object"===Object(s["a"])(n[o])&&n[o].findIndex(function(e){return e.indexOf(t.recodrdKeyowrd)>-1})>-1&&(r=!0);r&&e.push(n)}),e},[]);return e}}),watch:{$route:function(){this.initCustomerDetail3()}},methods:Object(i["a"])({},Object(c["b"])(["setPageLock"]),{highlight:function(t){return t.replace(new RegExp(this.recodrdKeyowrd+"(?!([^<]+)?<)","gi"),'<b style="color:#F58818;">$&</b>')},editRecord:function(t,e){this.currentRecord=t,this.panelOpen("newRecordModalOpen")},confirmRemoveRecord:function(t,e){this.currentDelIndex=e,this.warningMessage="您是否確認要刪除".concat(this.customer.info.name,"於").concat(t.date,"的拜訪記錄？"),this.panelOpen("warningModalOpen")},removeRecord:function(t,e){this.records[this.currentYear].data.splice(e,1)},submitNewRecord:function(){this.panelClose("warningModalOpen")},editNewNote:function(){this.note={noteContent:""},this.noteEdit=!0},insertOrUpdateNote:function(){var t=this;this.noteEdit=!1,this.noteIsNewEdit?Object(l["d"])(this.$store.state.userInfo.id,this.$store.state.custInfo.ID,this.note.noteContent).then(function(e){e.header&&"200"===e.header.status?t.getRemoteNote():t.$toast.info({title:e.header.message})}):Object(l["Ab"])(this.$store.state.userInfo.id,this.$store.state.custInfo.ID,this.note.noteContent,this.note.date,this.note.time)},getRemoteNote:function(){var t=this;Object(l["K"])(this.$store.state.userInfo.id,this.$store.state.custInfo.ID).then(function(e){if(e.header&&"200"===e.header.status)if(e.body.detail&&e.body.detail.length>0){var n=e.body.detail;n.sort(function(t,e){return t.NOTE_TIME>e.NOTE_TIME?1:-1}),n.sort(function(t,e){return t.NOTE_DATE<e.NOTE_DATE?1:-1}),t.noteIsNewEdit=!1,t.note={noteContent:n[0].NOTE_STRING,date:n[0].NOTE_DATE,time:n[0].NOTE_TIME}}else t.noteIsNewEdit=!0,t.note=null;else t.$toast.info({title:"連線逾時"})})},initCustomerDetail3:function(){this.getRemoteNote()},getTagName:function(t){var e=[];return e.push(t.split(",")),e[0]},getQueryNote:function(t){var e=this,n="N",r=this.records,o=this;Object(l["kb"])(this.$store.state.userInfo.id,this.$store.state.custInfo.ID,n,t).then(function(n){for(var a=0;a<r.length;a++)r[a].year==t&&o.$set(o.records[a],"data",n.body.detail);e.$forceUpdate()})}}),beforeMount:function(){var t=this.$route.name.split(/-/g).reverse();this.currentTab=Number(t[0]);for(var e=new Date,n=10,r=e.getFullYear()-(1911+n-1),o=0;o<n;o++)this.records[o]={year:r+o,data:[]}},mounted:function(){var t=Object(a["a"])(regeneratorRuntime.mark(function t(){var e,n,r,o,a=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:e="N",n=this.records[this.currentYear].year,r=this.records,o=this,Object(l["kb"])(this.$store.state.userInfo.id,this.$store.state.custInfo.ID,e,n).then(function(t){for(var e=0;e<r.length;e++)o.records[e].year==n&&o.$set(o.records[e],"data",t.body.detail);a.$forceUpdate()}),setTimeout(function(){a.carouselPage=a.$refs.carousel.pageCount,a.carouselRendered=!0,a.currentYear=a.records.length-1});case 6:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()}),v=g,y=n("2877"),w=Object(y["a"])(v,r,o,!1,null,null,null);w.options.__file="CustomerDetail3.vue";e["default"]=w.exports},"53ca":function(t,e,n){"use strict";function r(t){return r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function o(t){return o="function"===typeof Symbol&&"symbol"===r(Symbol.iterator)?function(t){return r(t)}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":r(t)},o(t)}n.d(e,"a",function(){return o})}}]);
//# sourceMappingURL=chunk-72e95932.bfb5a075.js.map