{"version":3,"sources":["webpack:///./node_modules/core-js/modules/es6.array.find-index.js","webpack:///./src/desktop/views/CustomerDetail3.vue?d18a","webpack:///src/desktop/views/CustomerDetail3.vue","webpack:///./src/desktop/views/CustomerDetail3.vue?69ba","webpack:///./src/desktop/views/CustomerDetail3.vue","webpack:///./node_modules/@babel/runtime/helpers/esm/typeof.js"],"names":["$export","__webpack_require__","$find","KEY","forced","Array","P","F","findIndex","callbackfn","this","arguments","length","undefined","render","_vm","_h","$createElement","_c","_self","attrs","loading","current","currentTab","staticClass","_v","on","click","$event","panelOpen","ref","value","carouselPage","perPage","scrollPerPage","paginationEnabled","navigationEnabled","_l","record","rid","key","class","active","currentYear","getQueryNote","year","_s","directives","name","rawName","expression","type","placeholder","domProps","input","target","composing","recodrdKeyowrd","_m","records","data","i","rowspan","width","EVENT_DATE","NOTE_STRING","innerHTML","highlight","RECORD_STRING","currentIndex","getTagName","SUB_CLS_CODE","tag","j","editRecord","removeRecord","open","newRecordModalOpen","currentRecord","close","panelClose","submit","submitNewRecord","warningModalOpen","message","warningMessage","staticRenderFns","CustomerDetail3vue_type_script_lang_js_","mixins","common","isSearch","carouselRendered","noteEdit","currentDelIndex","noteIsNewEdit","note","components","Avatar","CustomerInfo","TabHeader","Carousel","vue_carousel_min","Slide","WarningModal","NewRecordModal","computed","Object","objectSpread","vuex_esm","searchResult","_this","result","customer","reduce","array","index","forEach","hasKeyword","indexOf","esm_typeof","o","push","watch","$route","initCustomerDetail3","methods","word","replace","RegExp","confirmRemoveRecord","concat","info","date","splice","editNewNote","noteContent","insertOrUpdateNote","_this2","service","$store","state","userInfo","id","custInfo","ID","then","header","status","getRemoteNote","$toast","title","time","_this3","body","detail","sort","a","b","NOTE_TIME","NOTE_DATE","val","newVal","split","rocyear","_this4","is_done","rec","$this","$set","$forceUpdate","beforeMount","routeNumber","reverse","Number","d","Date","yearLength","getFullYear","mounted","_mounted","asyncToGenerator","regeneratorRuntime","mark","_callee","_this5","wrap","_context","prev","next","setTimeout","$refs","carousel","pageCount","stop","apply","views_CustomerDetail3vue_type_script_lang_js_","component","componentNormalizer","options","__file","__webpack_exports__","_typeof2","obj","Symbol","iterator","constructor","prototype","_typeof"],"mappings":"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","file":"js/chunk-72e95932.bfb5a075.js","sourcesContent":["'use strict';\n// 22.1.3.9 Array.prototype.findIndex(predicate, thisArg = undefined)\nvar $export = require('./_export');\nvar $find = require('./_array-methods')(6);\nvar KEY = 'findIndex';\nvar forced = true;\n// Shouldn't skip holes\nif (KEY in []) Array(1)[KEY](function () { forced = false; });\n$export($export.P + $export.F * forced, 'Array', {\n  findIndex: function findIndex(callbackfn /* , that = undefined */) {\n    return $find(this, callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n  }\n});\nrequire('./_add-to-unscopables')(KEY);\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return (true)?_c('main',[_c('customer-info',{attrs:{\"loading\":false}}),_c('tab-header',{attrs:{\"current\":_vm.currentTab}}),_c('div',{staticClass:\"tab-content\"},[_c('div',{staticClass:\"container-fluid\"},[_c('div',{staticClass:\"tab-pane active show\"},[_c('h4',{staticClass:\"text-green mt-5 mb-3\"},[_vm._v(\"\\n          日誌紀錄\\n          \"),_c('a',{staticClass:\"btn btn-default btn-sm m-0\",on:{\"click\":function($event){_vm.panelOpen('newRecordModalOpen')}}},[_vm._v(\"新增紀錄\")])]),_c('div',{staticClass:\"record-control row\"},[_c('div',{staticClass:\"col-9\"},[_c('carousel',{ref:\"carousel\",attrs:{\"value\":_vm.carouselPage,\"perPage\":8,\"scrollPerPage\":false,\"paginationEnabled\":false,\"navigationEnabled\":true}},_vm._l((_vm.records),function(record,rid){return _c('slide',{key:(\"record-item-\" + rid)},[_c('button',{staticClass:\"item\",class:{'active': _vm.currentYear == rid},on:{\"click\":function($event){_vm.currentYear=rid; _vm.getQueryNote(record.year)}}},[_vm._v(\"\\n                  \"+_vm._s(record.year)+\"\\n                \")])])}))],1),_c('div',{staticClass:\"col-3\"},[_c('form',{staticClass:\"form search-container\"},[_c('div',{staticClass:\"form-group\"},[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.recodrdKeyowrd),expression:\"recodrdKeyowrd\"}],staticClass:\"form-control\",attrs:{\"type\":\"text\",\"placeholder\":\"輸入關鍵字\"},domProps:{\"value\":(_vm.recodrdKeyowrd)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.recodrdKeyowrd=$event.target.value}}}),_vm._m(0)])])])]),(_vm.records[_vm.currentYear].data && _vm.records[_vm.currentYear].data.length)?_c('div',{staticClass:\"record-container\"},_vm._l((_vm.records[_vm.currentYear].data),function(record,i){return _c('div',{key:(\"event-record-\" + i),staticClass:\"record-item\"},[_c('div',{staticClass:\"record-table\"},[_c('table',{staticClass:\"table insurance-green\"},[_c('tr',[_c('th',{attrs:{\"rowspan\":\"2\",\"width\":\"100\"}},[_vm._v(_vm._s(record.EVENT_DATE))]),_c('th',{attrs:{\"width\":\"100\"}},[_vm._v(\"私人筆記\")]),_c('td',[(!record.NOTE_STRING || record.NOTE_STRING==='')?_c('div',{staticClass:\"content empty\"},[_vm._v(\"您尚未填寫私人筆記\")]):_c('div',{domProps:{\"innerHTML\":_vm._s(_vm.highlight(record.NOTE_STRING))}})])]),_c('tr',[_c('th',[_vm._v(\"活動日誌\")]),_c('td',[(record.RECORD_STRING==='' &&  record.currentIndex==='')?_c('div',{staticClass:\"content empty\"},[_vm._v(\"\\n                      您尚未填寫拜訪紀錄\\n                    \")]):_c('div',{staticClass:\"content\"},[_c('h5',{domProps:{\"innerHTML\":_vm._s(_vm.highlight(record.RECORD_STRING))}}),_c('div',{staticClass:\"list badgets\"},_vm._l((_vm.getTagName(record.SUB_CLS_CODE)),function(tag,j){return _c('div',{key:(\"record-\" + i + \"-tag-\" + j),staticClass:\"badget gray item\",domProps:{\"innerHTML\":_vm._s(_vm.highlight(tag))}})}))])])])])]),_c('div',{staticClass:\"record-action text-right\"},[_c('a',{staticClass:\"btn btn-default btn-icon btn-sm my-0\",on:{\"click\":function($event){_vm.editRecord(record, i)}}},[_c('i',{staticClass:\"icon-edit\"})]),_c('br'),_c('a',{staticClass:\"btn btn-red btn-icon btn-sm\",on:{\"click\":function($event){_vm.removeRecord(record, i)}}},[_c('i',{staticClass:\"icon-trashcan\"})])])])})):_c('div',{staticClass:\"empty-block\"},[(_vm.isSearch)?_c('span',[_vm._v(\"找不到符合的資料，建議換其他關鍵字進行搜尋\")]):_c('span',[_vm._v(\"尚未有任何已完成的拜訪\")])])])])]),_c('new-record-modal',{attrs:{\"open\":_vm.newRecordModalOpen,\"record\":_vm.currentRecord},on:{\"close\":function($event){_vm.panelClose('newRecordModalOpen')},\"submit\":_vm.submitNewRecord}}),_c('warning-modal',{attrs:{\"open\":_vm.warningModalOpen,\"message\":_vm.warningMessage},on:{\"close\":function($event){_vm.panelClose('warningModalOpen')},\"submit\":_vm.removeRecord}})],1):_vm._e()}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('button',{staticClass:\"btn btn-icon btn-text m-0\",attrs:{\"type\":\"submit\"}},[_c('i',{staticClass:\"icon-search\"})])}]\n\nexport { render, staticRenderFns }","<template>\n  <main v-if=\"true\">\n    <customer-info :loading=\"false\"/>\n    <tab-header :current=\"currentTab\"/>\n    <div class=\"tab-content\">\n      <div class=\"container-fluid\">\n        <div class=\"tab-pane active show\">\n          <h4 class=\"text-green mt-5 mb-3\">\n            日誌紀錄\n            <a @click=\"panelOpen('newRecordModalOpen')\" class=\"btn btn-default btn-sm m-0\">新增紀錄</a>\n          </h4>\n          <!-- {{currentYear}} -->\n          <div class=\"record-control row\">\n            <div class=\"col-9\">\n              <carousel\n              ref=\"carousel\"\n              :value=\"carouselPage\"\n              :perPage=\"8\"\n              :scrollPerPage=\"false\"\n              :paginationEnabled=\"false\"\n              :navigationEnabled=\"true\">\n                <slide\n                v-for=\"(record, rid) in records\"\n                :key=\"`record-item-${rid}`\">\n                  <button class=\"item\"\n                  :class=\"{'active': currentYear == rid}\"\n                  @click=\"currentYear=rid; getQueryNote(record.year)\">\n                    {{ record.year }}\n                  </button>\n                </slide>\n              </carousel>\n            </div>\n            <div class=\"col-3\">\n              <form class=\"form search-container\">\n                <div class=\"form-group\">\n                  <input type=\"text\" v-model=\"recodrdKeyowrd\" class=\"form-control\" placeholder=\"輸入關鍵字\">\n                  <button type=\"submit\" class=\"btn btn-icon btn-text m-0\">\n                    <i class=\"icon-search\"></i>\n                  </button>\n                </div>\n              </form>\n            </div>\n          </div>\n          <div class=\"record-container\" v-if=\"records[currentYear].data && records[currentYear].data.length\">\n            <div class=\"record-item\"\n            v-for=\"(record, i) in records[currentYear].data\"\n            :key=\"`event-record-${i}`\">\n            <!-- {{record}} -->\n              <div class=\"record-table\">\n                <table class=\"table insurance-green\">\n                  <tr>\n                    <th rowspan=\"2\" width=\"100\">{{record.EVENT_DATE}}</th>\n                    <th width=\"100\">私人筆記</th>\n                    <td>\n                      <div class=\"content empty\" v-if=\"!record.NOTE_STRING || record.NOTE_STRING===''\">您尚未填寫私人筆記</div>\n                      <div v-else v-html=\"highlight(record.NOTE_STRING)\"></div>\n                    </td>\n                  </tr>\n                  <tr>\n                    <th>活動日誌</th>\n                    <td>\n                      <div class=\"content empty\" v-if=\"record.RECORD_STRING==='' &&  record.currentIndex===''\">\n                        您尚未填寫拜訪紀錄\n                      </div>\n                      <div class=\"content\" v-else>\n                        <h5 v-html=\"highlight(record.RECORD_STRING)\"></h5>\n                        <div class=\"list badgets\">\n                          <!-- {{record.SUB_CLS_CODE}} -->\n                          <div class=\"badget gray item\"\n                          v-for=\"(tag,j) in getTagName(record.SUB_CLS_CODE)\"\n                          :key=\"`record-${i}-tag-${j}`\" v-html=\"highlight(tag)\">\n                          </div>\n                        </div>\n                      </div>\n                    </td>\n                  </tr>\n                </table>\n              </div>\n              <div class=\"record-action text-right\">\n                <a class=\"btn btn-default btn-icon btn-sm my-0\" @click=\"editRecord(record, i)\">\n                  <i class=\"icon-edit\"></i>\n                </a>\n                <br/>\n                <a class=\"btn btn-red btn-icon btn-sm\" @click=\"removeRecord(record, i)\">\n                  <i class=\"icon-trashcan\"></i>\n                </a>\n              </div>\n            </div>\n          </div>\n          <div class=\"empty-block\" v-else>\n            <span v-if=\"isSearch\">找不到符合的資料，建議換其他關鍵字進行搜尋</span>     \n            <span v-else>尚未有任何已完成的拜訪</span>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <!-- Modal -->\n    <new-record-modal\n    :open=\"newRecordModalOpen\"\n    :record=\"currentRecord\"\n    @close=\"panelClose('newRecordModalOpen')\"\n    @submit=\"submitNewRecord\"/>\n\n    <warning-modal\n    :open=\"warningModalOpen\"\n    :message=\"warningMessage\"\n    @close=\"panelClose('warningModalOpen')\"\n    @submit=\"removeRecord\" />\n  </main>\n</template>\n\n<script>\nimport { mapActions, mapGetters } from 'vuex';\nimport { Carousel, Slide } from 'vue-carousel';\nimport { commonMixin } from '../../mixins/common';\nimport { getNote } from '../../service';\nimport { addNote } from '../../service';\nimport { updateNote } from '../../service';\nimport { queryNoteList } from '../../service'\n\nimport Avatar from '../../components/Avatar';\nimport CustomerInfo from '../components/CustomerDetail/CustomerInfo';\nimport TabHeader from '../components/CustomerDetail/TabHeader';\n\nimport WarningModal from '../components/WarningModal';\nimport NewRecordModal from '../components/NewRecordModal';\nimport { log } from 'util';\n\n\nexport default {\n  name: 'CustomerDetail',\n  mixins: [commonMixin],\n  data () {\n    return {\n      isSearch: false,\n      warningMessage: '',\n      currentRecord: null,\n      newRecordModalOpen: false,\n      records: [],\n      currentYear: 0,\n      carouselRendered: false,\n      carouselPage: 0,\n      recodrdKeyowrd: '',\n      currentTab: 0,\n      noteEdit: false,\n      warningModalOpen: false,\n      currentDelIndex: 0,\n      noteIsNewEdit: true,\n      note: null,\n      \n    }\n  },\n  components: { \n    Avatar, CustomerInfo, TabHeader, \n    // basic component\n    Carousel, Slide, WarningModal, NewRecordModal\n  },\n  computed: {\n    ...mapGetters(['BaseUrl']),\n    searchResult () {\n      if(!this.recodrdKeyowrd.length) return []\n\n      let result = this.customer.record.reduce((array, year, index) => {\n        year.data.forEach(record => {\n          let hasKeyword = false\n          for(var i in record) {\n            if (typeof record[i]=='string') {\n              if (record[i].indexOf(this.recodrdKeyowrd) > -1) hasKeyword  =true\n            } else if (typeof record[i]==='object') {\n              if (record[i].findIndex(o => o.indexOf(this.recodrdKeyowrd)>-1) > -1) hasKeyword  =true\n            }\n          }\n          if(hasKeyword) {\n            array.push(record)\n          }\n        })\n\n        return array\n      }, [])\n\n      return result\n    }\n  },\n  watch: {\n    \"$route\": function() {\n      this.initCustomerDetail3()\n    }\n  },\n  methods: {\n    ...mapActions([\n      'setPageLock'\n    ]),\n    highlight (word) {\n      return word.replace(new RegExp(this.recodrdKeyowrd + '(?!([^<]+)?<)', 'gi'), '<b style=\"color:#F58818;\">$&</b>')\n    },\n    editRecord (record, i) {\n      this.currentRecord = record\n      this.panelOpen('newRecordModalOpen')\n    },\n    confirmRemoveRecord (record, i) {\n      this.currentDelIndex = i\n      this.warningMessage = `您是否確認要刪除${this.customer.info.name}於${record.date}的拜訪記錄？`\n      this.panelOpen('warningModalOpen')\n    },\n    removeRecord (record, i) {\n      this.records[this.currentYear].data.splice(i, 1)\n    },\n    submitNewRecord () {\n      this.panelClose('warningModalOpen')\n    },\n    editNewNote() {\n      this.note = {\n        noteContent: ''\n      }\n      this.noteEdit = true\n    },\n    insertOrUpdateNote() {\n      this.noteEdit = false\n      if(this.noteIsNewEdit) {\n        addNote(this.$store.state.userInfo.id, this.$store.state.custInfo.ID, this.note.noteContent).then(result => {\n          if(result.header && result.header.status === '200'){\n            this.getRemoteNote()\n          }else{\n            this.$toast.info({title: result.header.message})\n          }\n        })\n      } else {\n        updateNote(this.$store.state.userInfo.id, this.$store.state.custInfo.ID, this.note.noteContent, this.note.date, this.note.time)\n      }\n    },\n    getRemoteNote() {\n      getNote(this.$store.state.userInfo.id, this.$store.state.custInfo.ID).then(result => {\n        if(result.header && result.header.status === '200'){\n          if(result.body.detail && result.body.detail.length > 0) {\n            let detail = result.body.detail\n            detail.sort((a, b) => {\n              return a.NOTE_TIME > b.NOTE_TIME ? 1 : -1\n            })\n            detail.sort((a, b) => {\n              return a.NOTE_DATE < b.NOTE_DATE ? 1 : -1\n            })\n            this.noteIsNewEdit = false\n            this.note = {\n              noteContent: detail[0].NOTE_STRING,\n              date: detail[0].NOTE_DATE,\n              time: detail[0].NOTE_TIME\n            }\n          } else {\n            this.noteIsNewEdit = true\n            this.note = null\n          }\n        }else{\n          this.$toast.info({title: '連線逾時'})\n        }\n      })\n    },\n    initCustomerDetail3() {\n      this.getRemoteNote()\n    },\n    getTagName(val){\n      let newVal = []\n      newVal.push(val.split(','));\n      return newVal[0]\n    },\n    getQueryNote(rocyear){\n      let is_done = 'N'\n      let rec = this.records\n      let $this = this\n      // queryNoteList('A28978309I', 'F18316575J', is_done, rocyear).then(result =>{\n      queryNoteList(this.$store.state.userInfo.id, this.$store.state.custInfo.ID, is_done, rocyear).then(result =>{\n        // console.log(\"查詢筆記簿 API:\"+JSON.stringify(result.body.detail))\n        for(let i=0;i<rec.length;i++){\n          if(rec[i].year == rocyear){\n            $this.$set($this.records[i], \"data\" , result.body.detail)\n          }\n        }\n        this.$forceUpdate()\n      })\n    }\n  },\n  beforeMount () {\n    let routeNumber = (this.$route.name.split(/-/g)).reverse()\n    this.currentTab = Number(routeNumber[0])\n    let d = new Date()\n    let yearLength = 10\n    let currentYear = d.getFullYear() - (1911 + yearLength -1)\n    for(let i= 0;i<yearLength; i++){\n      this.records[i] = {\n        year: currentYear + i,\n        data:[]\n      }\n    }\n  },\n  async mounted () {\n    let is_done = 'N'\n    let rocyear = this.records[this.currentYear].year\n    let rec = this.records\n    let $this = this\n    // query note AIP\n    queryNoteList(this.$store.state.userInfo.id, this.$store.state.custInfo.ID, is_done, rocyear).then(result =>{\n    // queryNoteList('A28978309I', 'F18316575J', is_done, '107').then(result =>{\n      // console.log(\"查詢筆記簿 API:\"+JSON.stringify(result.body.detail))\n       for(let i=0;i<rec.length;i++){\n        if($this.records[i].year == rocyear){\n          $this.$set($this.records[i], \"data\" , result.body.detail)\n          // rec[i].data = result.body.detail\n        }\n      }\n\n      \n      this.$forceUpdate()\n      \n    })\n   \n    setTimeout(() => {\n      this.carouselPage = this.$refs.carousel.pageCount\n      this.carouselRendered = true\n      this.currentYear = this.records.length -1\n    })\n  }\n}\n</script>\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./CustomerDetail3.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./CustomerDetail3.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./CustomerDetail3.vue?vue&type=template&id=444b645a&\"\nimport script from \"./CustomerDetail3.vue?vue&type=script&lang=js&\"\nexport * from \"./CustomerDetail3.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"CustomerDetail3.vue\"\nexport default component.exports","function _typeof2(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof2 = function _typeof2(obj) { return typeof obj; }; } else { _typeof2 = function _typeof2(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof2(obj); }\n\nexport default function _typeof(obj) {\n  if (typeof Symbol === \"function\" && _typeof2(Symbol.iterator) === \"symbol\") {\n    _typeof = function _typeof(obj) {\n      return _typeof2(obj);\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : _typeof2(obj);\n    };\n  }\n\n  return _typeof(obj);\n}"],"sourceRoot":""}